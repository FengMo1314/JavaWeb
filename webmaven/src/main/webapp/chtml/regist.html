<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>æ³¨å†Œ</title>
    <style>
        img {
            width: 10%;
            height: 10%;
        }

    </style>
</head>
<body>
<div class="box">
    <form enctype="multipart/form-data" method="post">
        <input id="img" name="file" ref size="50" type="file"/>
        <button onclick="upimg()" type="button">ä¸Šä¼ å¤´åƒ</button>
    </form>
</div>
<div class="box-img">
</div>
<!--<img src="../userUpdata/2022-8æœˆ-å»ºæ¡£ç«‹å¡.jpg" alt="" sizes="" srcset="">-->
<!--<form action="/ServletUpload" method="post" enctype="multipart/form-data">-->
<!--    <input type="file" name="file" size="50"/>-->
<!--    <br/>-->
<!--    <input type="submit" value="Upload File"/>-->
<!--</form>-->
<div class="box2">
    <form action="#" method="post">
        <input class="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" type="text">
        <br>
        <input class="password" placeholder="è¯·è¾“å…¥å¯†ç " type="password">
        <br>
        <input id="sub" onclick="register()" type="button" value="æ³¨å†Œ">
    </form>
</div>
<h1 class="mesg"></h1>
</body>
<script src="../js/jquery.min.js"></script>
<script src="../js/until.js"></script>
<script>
    // $(function(){
    //     pushHistory();
    //     window.addEventListener("popstate", function(e) {
    //         alert("æˆ‘ç›‘å¬åˆ°äº†æµè§ˆå™¨çš„è¿”å›æŒ‰é’®äº‹ä»¶å•¦");//æ ¹æ®è‡ªå·±çš„éœ€æ±‚å®ç°è‡ªå·±çš„åŠŸèƒ½
    //     }, false);
    //     function pushHistory() {
    //         var state = {
    //             title: "title",
    //             url: "#"
    //         };
    //         window.history.pushState(state, "title", "#");
    //     }
    // });
    // function mains() {
    //     register()
    //     // let isPath=upimg.value;
    //     // let imgPath=upimg.value;
    //     // if (imgPath === "" || isPath ===false) {
    //     //     $(".mesg").html("ä¸è¦å¤´åƒğŸ˜¢");
    //     //     register(isPath);
    //     // } else {
    //     //     $(".mesg").append("æ²¡æœ‰å¤´åƒ");
    //     //     $(".box").html("ä¸“å¿ƒæ³¨å†Œ")
    //     // }
    // }

    function register() {
        let isPath = upimg();
        const username = $(".username").val();
        const password = $(".password").val();
        if (username.length <= 0 || password.length <= 0) {
            $(".mesg").html("<h2>è´¦æˆ·æˆ–è€…å¯†ç ä¸èƒ½ä¸ºç©º</h2>");
        } else {
            $.ajax({
                url: 'http://localhost:8080/lh.com/cregistAll',//è¯·æ±‚åœ°å€
                type: 'post',//è¯·æ±‚æ–¹å¼
                headers: {"Content-type": "application/json;charset=UTF-8"},
                async: true,//æ˜¯å¦å¼‚æ­¥
                data: JSON.stringify({
                    "username": username,
                    "password": password,
                    "isPath": isPath
                }),
                // JSON.stringify({"names": names}),
                contentType: "application/json",
                dataType: "json",
                success: function (res) {//è¯·æ±‚æˆåŠŸå›è°ƒå‡½æ•°
                    console.log(res["state"])
                    let html = "";
                    switch (res["state"]) {
                        case "err":
                            html += `<h2>${res["mesg"]}</h2>`;
                            break;
                        case "-1":
                            html += `<h2>${res["mesg"]}</h2>
                                    <a href="../JSONindex.html">è¿”å›é¦–é¡µ</a>
                                    <a href="user.jsp">ç”¨æˆ·ä¸­å¿ƒ</a>
                                   `;
                            break;
                        case "0":
                            html += `<h2>${res["mesg"]}</h2>
                                  <a href="login.html">å»ç™»é™†</a>`;
                            // window.location.replace("/lh.com");
                            break;
                        case "1":
                            html += `<h2>${res["mesg"]}</h2>
                                  <a href="login.html">å»ç™»é™†</a>
                                    <a href="#">å¿˜è®°å¯†ç </a>
                                     `;
                            break;
                    }
                    $(".mesg").html(html);
                },
                error(err) {//è¯·æ±‚å¤±è´¥å›è°ƒå‡½æ•°
                    alert(err)
                }
            })
        }
    }


    function upimg() {
        let imgPath = "";
        let isPath = true;
        const imgs = document.getElementById("img");
        if (!imgs.files || imgs.files.length <= 0) {
            alert("NOJPG")
            return isPath = false;
        } else {
            const formData = new FormData();//æ–°å»ºä¸€ä¸ªformdataç”¨äºå­˜å‚¨æ•°æ®
            formData.append("userPatn", imgs.files[0]);
            // // var json= JSON.stringify({"img":formData})
            console.log("json:", formData)
            $.ajax({
                    url: 'http://localhost:8080/lh.com/userUpdata',//è¯·æ±‚åœ°å€
                    type: 'post',//è¯·æ±‚æ–¹å¼
                    // headers: {"Content-type": "application/json;charset=UTF-8"},
                    async: false,//æ˜¯å¦å¼‚æ­¥
                    data: formData,
                    dataType: 'json',
                    processData: false, // å‘Šè¯‰jQueryä¸è¦å»å¤„ç†å‘é€çš„æ•°æ®
                    contentType: false, // å‘Šè¯‰jQueryä¸è¦å»è®¾ç½®Content-Typeè¯·æ±‚å¤´
                    success: function (res) {//è¯·æ±‚æˆåŠŸå›è°ƒå‡½æ•°
                        console.log(res)

                        if (res["imgPath"] == "" || res["isPath"] == "false") {
                            isPath = res["isPath"];
                            $(".mesg").html(`
                            <h1>è¯·ä¸Šä¼ æœ‰æ•ˆçš„æ–‡ä»¶å¥¥</h1>
                            `)
                        } else {
                            imgPath = res['imgPath'];
                            $(".mesg").html(`
                            <h1>ä¸Šä¼ æˆåŠŸ</h1>
                            `)
                            $(".box").html("");
                            $(".box-img").append(`
                                 <img src="../${res["imgPath"]}" id="newImg">
                                `)
                        }
                    },
                    error(err) {//è¯·æ±‚å¤±è´¥å›è°ƒå‡½æ•°
                        console.log("æ˜¯é˜¿æ‹œ");
                        console.log(err);
                    }
                }
            )
        }
        return {isPath, imgPath};
    }
</script>
</html>